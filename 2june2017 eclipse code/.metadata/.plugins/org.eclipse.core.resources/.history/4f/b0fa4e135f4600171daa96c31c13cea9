package com.dgca;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class DbConnection {

	public Connection getdatabaseConnection() {
		Connection conn = null;
		try {
			Class.forName("com.mysql.jdbc.Driver");
			conn = DriverManager.getConnection("jdbc:mysql://localhost/dgcadbtest1", "master", "public");
			System.out.println("Connecting to a MYSQL database...");
		} catch (ClassNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		return conn;
	}

	public boolean checkrecordExists(String ipAddress, Connection conn) {
		//PreparedStatement pstmt = null;
		ResultSet rs = null;
		boolean status=false;
	

		//String sql = "select * from  DGCAMapping where ipaddress=" + "'" + ipAddress + "'";
		String sql = "select IpAddress from  DGCAMapping where IpAddress=?";
		System.out.println("query" + sql);

		try {
			 PreparedStatement pstmt = conn.prepareStatement(sql);
			 pstmt.setString(1, ipAddress);

			// String sql = "select * from DGCAMapping where
			// ipaddress=172.18.18.19";
			rs = pstmt.executeQuery(sql);
			if (!rs.next() ) {
				status=false;
			    System.out.println("resultset does not data");
			}
			else{
				status=true;
			}
			rs.close();
			pstmt.close();
			
		}
		 catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
			
	public  boolean insertRecord(String ipAdress,String hostName,String hostName)
	{
				try {
					System.out.println("IpAddress in insertion call" + ipAddress);
					String sqlInsert = "insert into DGCAMapping(IpAddress,NAME,DISPLAYNAME) values(?,?,?)";

					System.out.println("Insert Sql Query" + sqlInsert);

					 PreparedStatement pstmt1 = conn.prepareStatement(sqlInsert);
					System.out.println("Prepared Statement" + pstmt1);
					//pstmt1.setInt(1, (Integer) null);
					pstmt1.setString(1, ipAddress);
					pstmt1.setString(2, hostName);
					pstmt1.setString(3, hostName);
					pstmt1.executeUpdate();
					System.out.println("after insertion " + pstmt1.executeUpdate());
					pstmt1.close();
					
				} catch (SQLException se) {
					se.printStackTrace();
				}

			}
			
			
			
		
	/*	
	finally {
		// finally block used to close resources
		try {
			rs.close();
			pstmt.close();
			//conn.close();
		} catch (Exception e) {
			// TODO: handle exception
			e.printStackTrace();
		}
		

	}*/

		return status;
	}

}
